---
title: "Lecture 9 Solved Problems"
author: "JMG"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(openintro)
library(tidyverse)
library(ggformula)
library(ggmosaic)
```


## Single Proportion Problems

### Parking Problem CI

> Is parking a problem on campus? A randomly selected group of 89 faculty and staff are asked whether they are satisfied with campus parking or not. Of the 89 individuals surveyed, 23 indicated that they are satisfied. What is the proportion $p$ of faculty and staff that are satisfied with campus parking?

The data corresponds to a sample proportion. Let's check the success-failure condition. Our point estimate $\hat{p}$ is
```{r}
(p_hat <- 23 / 89)
```

Then, 
```{r}
n <- 89 # sample size
(n*p_hat)
(n*(1-p_hat))
```

We see that the success-failure condition is met. 

The plug-in principle gives the following estimate for standard error:
```{r}
(SE <- sqrt((p_hat*(1-p_hat))/n))
```

Then a 95% confidence interval (CI) is
```{r}
p_hat + 1.96 * c(-1,1) * SE
```

Thus, around 95% of the time we expect that our estimate will be between 0.167 and 0.349. 

### Football Example

In a survey of 1011 adults, 293 said that their favorite sport to watch is football. Find a point estimate for the population proportion of U.S. adults who say their favorite sport to watch is football. Provide a 93% confidence interval for the estimate. 

Our point estimate is

```{r}
(p_hat <- 293 / 1011) 
```

Before obtaining a confidence interval, we should check the success-failure condition:

```{r}
n <- 1011
(n*p_hat)
(n*(1-p_hat))
```

The success-failure condition is met. Now we need to estimate the standard error:

```{r}
(SE <- sqrt((p_hat*(1-p_hat))/n))
```

Now for a 93% CI, we need to know the appropriate $z^{\ast}$ value. This is the value such that 93% of the total area under the standard normal curve falls between $-z^{\ast}$ and $-z^{\ast}$. We can find this as follows:

```{r}
(z_ast <- -qnorm((1.0-0.93)/2))
```

Let's confirm that this is correct:

```{r}
pnorm(1.8119) - pnorm(-1.8119)
```

Finally, we obtain our 93% CI:

```{r}
(CI <- p_hat + z_ast*c(-1,1)*SE)
```

Thus, we can be 93% confident that between 26% and 32% of adults in the U.S. say that football is their favorite sport. 

### Exercise 6.7

Our sample size and point estimate is
```{r}
(n <- 600)
(p_hat <- 0.56)
```

We check the success-failure condition
```{r}
(n*p_hat)
(n*(1-p_hat))
```

and see that it is met. Then, the margin of error for a 95% CI is
```{r}
(SE <- sqrt((p_hat*(1-p_hat))/n))
(marg_err <- 1.96*SE)
```

So a 95% CI is
```{r}
p_hat + c(-1,1)*marg_err
```

### Exercise 6.13

Our sample size and point estimate is
```{r}
(n <- 80)
(p_hat <- 53 / n)
```

Our null hypothesis is 

$H_{0}: p = 0.5$ That is, people can  not tell the difference between diet and regular soda. 

and our alternative hypothesis is

$H_{A}: p\neq 0.5$ That is, people can tell the difference between diet and regular soda

We check the success-failure condition with the $p_{0}=0.5$
```{r}
p0 <- 0.5
(n*p0)
(n*(1-p0))
```

We conclude that the success-failure condition is met. Now we obtain our standard error and z-score
```{r}
SE <- sqrt((p0*(1-p0))/n)
(z_score <- (p_hat - p0)/SE)
```

Then, our p-value will be the probability of obtaining a value that is as or more extreme than our observation. This is computed as
```{r}
2*(1 - pnorm(z_score))
```

Since this is less than $\alpha = 0.05$ we will reject the null hypothesis at the 0.05 significance level. Alternatively, we can use `prop.test`
```{r}
prop.test(53,80,p=0.5,correct = FALSE)
```

If it is true that people can not tell the difference between diet and regular soda, then we expect to obtain a result that is as or more extreme than 53 people correctly identifying the soda less than 0.4% of the time. 


## Difference of Proportion Problems

### 6.19

(a) False. Since $(p_{\text{male}} - p_{\text{female}}) > 0$, the proportion of males whose favorite color is black is higher than the proportion of females. 

(b) True. 

(c) True.

(d) True. 

(e) False. All you have to do is change signs. 


### Antismoking Example

During the 1990's intensive antismoking campaigns were sponsored by both federal and private agencies. Suppose the American Cancer Society randomly sampled 1500 adults in in 1992 and then sampled 1750 adults in 2002 to determine whether there was evidence that the percentage of smokers had decreased. The results of the two sample surveys are: in 1992, 555 out of 1500 adults indicate that they smoke, while in 2002, 578 out of 1750 indicate that they smoke. Estimate the difference in proportions of adult smokers between 1992 and 2002.  Obtain a 95% confidence interval for the estimate. 

Our estimate is

```{r}
n1 <- 1500
n2 <- 1750
p1 <- 555/n1
p2 <- 578/n2
(p_diff <- p1 - p2)
```

Next, we check the success-failure conditions

```{r}
c(n1*p1,n1*(1-p1),n2*p2,n2*(1-p2))
```


Since the conditions are met, we obtain our standard error:

```{r}
(SE <- sqrt(((p1*(1-p1))/n1) + ((p2*(1-p2))/n2)))
```

Finally, a 95% CI is

```{r}
(p_diff + 1.96*c(-1,1)*SE)
```

We can be 95% confident that the difference in the proportion of smokers from 1992 to 2002 is between 0.007 and 0.07. 

### 6.23

Here's what our data looks like:
```{r}
support_drilling <- c(rep("Yes",154),rep("No",180),rep("Do not know",104),rep("Yes",132),rep("No",126),rep("Do not know",131))
college_grad <- c(rep("Yes",438),rep("No",389))
college_grad <- factor(college_grad,levels=c("Yes","No"))
my_df <- tibble(support_drilling=support_drilling,college_grad=college_grad)
my_df %>% slice_sample(n=6)
```

A visualization:

```{r}
my_df %>% 
  ggplot() + 
  geom_mosaic(aes(x = product(support_drilling,college_grad), fill=support_drilling))
```

(a) 
```{r}
(p1 <- 104/438)
(p2 <- 131/389)
```



(b) First, we will conduct a hypothesis test using the `prop.test` command:
```{r}
prop.test(c(104,131),c(438,389),correct = FALSE)
```

In this case, we will reject the null hypothesis at the $\alpha = 0.05$ significance level since out p-value is 0.001573 which is less than 0.05. 

Now, the long way:
```{r}
n1 <- 438
n2 <- 389
p_diff <- p1 - p2
p_pooled <- (p1*n1 + p2*n2)/(n1 + n2)
(c(n1*p1,n1*(1-p1),n2*p2,n2*(1-p2)))
SE <- sqrt((p_pooled*(1-p_pooled))/n1 + (p_pooled*(1-p_pooled))/n2)
(z_val <- (p_diff - 0.0)/SE)
```

Compute the p-value
```{r}
(p_value <- 2*pnorm(-3.1608))
```

In this case, we will reject the null hypothesis at the $\alpha = 0.05$ significance level since out p-value is 0.001573 which is less than 0.05.

### Antismoking Example 


During the 1990's intensive antismoking campaigns were sponsored by both federal and private agencies. Suppose the American Cancer Society randomly sampled 1500 adults in in 1992 and then sampled 1750 adults in 2002 to determine whether there was evidence that the percentage of smokers had decreased. The results of the two sample surveys are: in 1992, 555 out of 1500 adults indicate that they smoke, while in 2002, 578 out of 1750 indicate that they smoke. Do these data indicate that the fraction of smokers decreased over this 10-year period?

To answer this question, we test the hypothesis

$$H_{0}: p_{1}-p_{2} = 0$$, that is, the proportion of smokers did not decrease.

versus

$$H_{A}: p_{1} - p_{2} > 0$$, that is, the proportion of smokers did decrease. 

Note that this is an example of a one-sided hypothesis test. 

This is easy to do with the `prop.test` command:

```{r}
prop.test(c(555,578),c(1500,1750),alternative = "greater",correct = FALSE)
```

Let's conduct the test "by-hand". That is, let's compute all of the necessary quantities. Since the null hypothesis value is $0$, we have to use the pooled proportion.

```{r}
n1 <- 1500
n2 <- 1750
p1 <- 555/n1
p2 <- 578/n2
p_diff <- p1 - p2
(p_pooled <- (p1*n1 + p2*n2)/(n1 + n2))
```


Then the standard error is

```{r}
(SE <- sqrt((p_pooled*(1-p_pooled)/n1) + ((p_pooled*(1-p_pooled))/n2))) 
```

The Z-score is then

```{r}
(z_val <- p_diff/SE)
```

Now we compute the p-value. This is where we use the fact that this is a one-sided test. Since it is one-sided greater than, we just want to know what is the probability of getting a value that is **greater** than what we have observed in the data under the assumption that the null hypothesis holds. 

```{r}
(p_val <- 1 - pnorm(z_val))
```


Not that this is the same p-value returned by our use of the `prop.test` command. 

Finally, we will reject the null hypothesis at the $\alpha = 0.05$ significance level since our p-value is less than $\alpha$. That is, we conclude that the data provides sufficient evidence to reject the null hypothesis that the proportion of smokers did not decrease. 

## One-Sample Means Problems 

### 7.1

(a)

```{r}
n <- 6
confidence_level <- 0.9
(t_ast <- -qt((1.0 - confidence_level)/2,df=n-1))
```

(b)

```{r}
n <- 21
confidence_level <- 0.98
(t_ast <- -qt((1.0 - confidence_level)/2,df=n-1))
```

(c)

```{r}
n <- 29
confidence_level <- 0.95
(t_ast <- -qt((1.0 - confidence_level)/2,df=n-1))
```

(d)

```{r}
n <- 12
confidence_level <- 0.99
(t_ast <- -qt((1.0 - confidence_level)/2,df=n-1))
```

### 7.4

(a)

```{r}
2*(1-pt(2.485,25))
```

Do not reject.

(b)

```{r}
2*(1-pt(0.5,17))
```

Do not reject. 

### 7.5

What we know is that $n=36$, so $\sqrt{n} = 6$, $t^{\ast}_{\text{df}}$ is given by

```{r}
(t_ast <- -qt((1-0.95)/2,35))
```

and that 

$$
\begin{align}
\bar{x} - 2.03 \frac{s}{6} = 18.985, \\
\bar{x} + 2.03 \frac{s}{6} = 21.015
\end{align}
$$

This is a system of two equations in two unknowns, that is, $\bar{x}$ and $s$.  An easy way to solve this in R is as follows:

```{r}
A <- matrix(c(1,-2.03/6,1,2.03/6),2,2,byrow = TRUE)
b <- c(18.985,21.015)
solve(A,b)
```

We can check this:

```{r}
x_bar <- 20
s <- 3
(x_bar - 2.03 * (s/6))
(x_bar + 2.03 * (s/6))
```



