---
title: "Lecture 10 Solved Problems"
author: "JMG"
date: "10/31/2021"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(openintro)
library(faraway)
library(tidyverse)
library(ggformula)
library(broom)
library(patchwork)
```


### The Cheddar Data

Let's begin by examining the help file for the `cheddar` data from the `faraway` package. 

Suppose we want to use a linear model to explore the relationship between the `Lactic` variable and the `taste` variable. Specifically, we are interested to know how the concentration of lactic acids influences the subjective taste score.

We should begin with a scatter plot.

```{r}
gf_point(taste~Lactic,data=cheddar)
```


**Question:** What does the scatter plot suggest about any association between the two variable? Based on the scatter plot, what do you think will be the value for the correlation between $x$ and $y$? 

Let's compute the correlation:

```{r}
(R_cheddar <- cor(cheddar$Lactic,cheddar$taste))
```

**Question:** What do you conclude based on the value of the correlation? How does the value correspond with what you guessed based on looking at the scatter plot? 

Let's fit a linear regression model with $x$=`Lactic` and $y$=`taste`. We will do this both by hand and using the `lm` command. First, by hand:

```{r}
x_bar <- mean(cheddar$Lactic)
y_bar <- mean(cheddar$taste)
s_x <- sd(cheddar$Lactic)
s_y <- sd(cheddar$taste)

(b_1 <- (s_y/s_x)*R_cheddar)
(b_0 <- y_bar - b_1*x_bar)

```

We interpret these results as saying that, if the model is reasonable, then for each unit increase in lactic acid concentration, there is an increase of 37.7 in the subjective taste score. 

Let's check our parameter estimates with the `lm` command. 

```{r}
(lm_fit <- lm(taste~Lactic,data=cheddar))
```

We do indeed obtain the same estimates. 

It is prudent to examine the residual plot for our fit in order to diagnose any potential failures for the basic assumptions required for a linear model to be reasonable. In order to obtain a residual plot, we need the residuals. The residuals can be obtained easily using the `augment` command from the `broom` package. Let's see what `augment` does. First, here is the first few rows for the oringal data:

```{r}
head(cheddar)
```

Now's let's see the effect of `augment`:

```{r}
augment(lm_fit) %>% head()
```
Note that, among other things, `augment` adds a column for the residuals that is named `.resid`. We can use this to plot the residuals as follows:

```{r}
augment(lm_fit) %>% gf_point(.resid~Lactic)
```

It's useful to add a horizontal line at $y=0$ in order to show where a residual value of 0 falls. This is done as follows:

```{r}
augment(lm_fit) %>% gf_point(.resid~Lactic) %>% gf_hline(yintercept=0,lwd=1,linetype="dashed")
```

**Question:** Does the residual plot suggest any particular concerns regarding the quality of the linear fit? 

Finally, we can also use the results from the `augment` command to plot our regression line:

```{r}
augment(lm_fit) %>% gf_point(taste~Lactic) %>% gf_line(.fitted~Lactic,lwd=1,color="blue")
```

Finally, let's look at the $R^2$ value for this model:

```{r}
R_cheddar^2
```

We would say that about 50% of the variation in the taste of cheddar cheese is explained by a linear model with the concentration of lactic acid as the response variable. 

Interestingly, the $R^2$ value is actually returned as part of the linear fit when using `lm`. The value can be access as follows:

```{r}
summary(lm_fit)$r.squared
```

### Exercise for You

Repeat the analysis from the previous example but use the `Acetic` variable for the concentration of acetic acid (log scale) instead of the concentration of acetic acid (log scale). 


### Exercise 8.1

**Ans.:** (a) The residual plot will show residuals that are randomly distributed around 0. The variance will appear approximately constant. (b) The residuals will decrease from left to right and therefore not be randomly distributed around 0. The variance will also decrease from left to right. 


### Exercise 8.19

Suppose we fit a regression line to predict the shelf life of an apple based on its weight. For a particular apple, we predict the shelf life to be 4.6 days. The apple's residual is -0.6 days. Did we over or under estimate the shelf-life of the apple? 

### Exercise 8.5 Plus

The two scatterplots show the relationship between mid-semester exam grades and final course grade recorded during several years for a stats course. 

```{r,message=FALSE,warning=FALSE}
exam_grades <- na.omit(exam_grades)
p1 <- exam_grades %>% ggplot(aes(x=exam1,y=course_grade)) + geom_point() + 
  geom_smooth(method = "lm",se=FALSE)
p2 <- exam_grades %>% ggplot(aes(x=exam2,y=course_grade)) + geom_point() + 
  geom_smooth(method = "lm",se=FALSE)

p1 + p2

```
 
 
 
(a) Based on these graphs, which of the two exams has the strongest correlation with the final exam grade? 



Let's compute these correlations using R:

```{r}
(R_exam1 <- cor(exam_grades$exam1,exam_grades$course_grade))
(R_exam2 <- cor(exam_grades$exam2,exam_grades$course_grade))
```

Do the computed correlation values agree with your answer to the question? 


(b) Can you think of a reason why the correlation between the exam you chose in 
part (a) and the final course grade is higher? 

Let's look at the residual plots for the two linear fits:

```{r}
pr1 <- augment(lm(course_grade~exam1,data=exam_grades)) %>% gf_point(.resid~exam1) %>% gf_hline(yintercept=0,lwd=1,linetype="dashed")

pr2 <- augment(lm(course_grade~exam2,data=exam_grades)) %>% gf_point(.resid~exam2) %>% gf_hline(yintercept=0,lwd=1,linetype="dashed")

pr1 + pr2

```


Do the residual plots indicate any problems with the linear fits to the data? 

Let's compute the linear fits and examine the results.

```{r}
(lm_fit_exam1 <- lm(course_grade~exam1,data=exam_grades))
(lm_fit_exam2 <- lm(course_grade~exam2,data=exam_grades))
```


How should we interpret the results? 


### Exercise 8.13 and 8.31 Plus

Consider the following data collected by researchers studying [anthropometry](https://en.wikipedia.org/wiki/Anthropometry):

```{r}
head(bdims)
```

We will plot the height of individuals versus their shoulder girth:

```{r}
bdims %>% gf_point(hgt~sho_gi)
```

Describe the relationship between shoulder girth and height. How would the relationship change if shoulder girth was measured in inches while the units of height remained in centimeters? 

Now, let's look at the weight of individuals versus their height.

```{r}
bdims %>% gf_point(wgt~hgt)
```

(a) Describe the relationship between height and weight. What is the value of the correlation? 

```{r}
# compute correlation

```



(b) Here is the results of a linear fit using least squares:

```{r}
lm_fit_bdims <- lm(wgt~hgt,data=bdims)
tidy(lm_fit_bdims)
```

Write an equation for the regression line. Interpret the slope and intercept in context. 


Here is a plot of the regression line:

```{r}
bdims %>% gf_point(wgt~hgt) %>% gf_lm(wgt~hgt)
```

Let's look at the corresponding residual plot:

```{r}
augment(lm_fit_bdims) %>% gf_point(.resid~hgt) %>% gf_hline(yintercept=0,lwd=1,linetype="dashed")
```

Are there any potential issues with the residuals that suggest a linear model may not be appropriate? 


What percent of the variability in weight can be explained by height? 


Conduct a test of the hypothesis $H_{0}:\beta_{1}=0$ versus $H_{A}:\beta_{1} \neq 0$. 


Compute a 95% confidence interval for the slope parameter. 

```{r}
# code for computing CI



```

We can ask R to return the confidence intervals for us in order to check our answer:

```{r}
tidy(lm_fit_bdims,conf.int = TRUE)
```


### Exercise 8.21 Plus



### Exercise 8.25 and 8.35 Plus



### Exercise 8.29 Plus








 